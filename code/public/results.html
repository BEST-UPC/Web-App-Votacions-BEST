<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>WebApp Votacions BEST Barcelona</title>

    <!-- Bootstrap Core CSS -->
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="../vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../dist/css/sb-admin-2.css" rel="stylesheet">

    <!-- Morris Charts CSS -->
    <link href="../vendor/morrisjs/morris.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/chartist/0.10.1/chartist.min.css" rel="stylesheet">

    <link rel="icon" type="image/png" href="../images/BEST_logomark.png">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


</head>

<body>

<div id="wrapper">

    <!-- Navigation -->
    <div id="navbar"></div>

    <div id="page-wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header" id="pollName">No name found!</h1>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-7">
                <div class="ct-chart ct-perfect-fourth" id="results"></div>
            </div>
            <!--<canvas class="col-lg-7" id="results">-->
            <!--</canvas>-->
        </div>

        <p id="text"> </p>
    </div>
    <!-- /#page-wrapper -->
</div>
<!-- /#wrapper -->

<!-- jQuery -->
<script src="../vendor/jquery/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="../vendor/bootstrap/js/bootstrap.min.js"></script>

<!-- Metis Menu Plugin JavaScript -->
<script src="../vendor/metisMenu/metisMenu.min.js"></script>

<!-- Morris Charts JavaScript -->
<script src="../vendor/raphael/raphael.min.js"></script>
<script src="../vendor/morrisjs/morris.min.js"></script>
<script src="../data/morris-data.js"></script>

<!-- Custom Theme JavaScript -->
<script src="../dist/js/sb-admin-2.js"></script>

<script src="js/cookie.js">  </script>
<script>
    if (getCookie("idtoken") == ""){
        window.location = "http://localhost:3000/login.html";
    }
    else{
        //alert(getCookie("idtoken"))
    }
</script>

<a href="#" onclick="signOut();">Sign out</a>
<script>
    function signOut() {
        var auth2 = gapi.auth2.getAuthInstance();
        auth2.signOut().then(function () {
            console.log('User signed out.');
        });
    }
</script>
<style>
    .ct-label{
        font-size:15px;
        color:black;
    }
</style>
<script src="js/navbar.js">  </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.3/Chart.bundle.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartist/0.10.1/chartist.js"></script>
<script>
    pollId=gup('id');
    id_token = getCookie("idtoken");
    $("#navbar").load("navbar.html",function(){
        initNavBar(JSON.parse(getCookie("profile")));
        var xhr = new XMLHttpRequest();
        xhr.open('POST', 'http://localhost:3000/egetResults');
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.onload = function() {
            var results = JSON.parse(xhr.responseText);
            if (results.status!='0'){
                alert(results.message);
                setTimeout(function(){
                    window.location="http://localhost:3000/login.html";
                },20);
                return 0;
            }


            var data = {
                // A labels array that can contain any sort of values
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'],
                // Our series array that contains series objects or in this case series data arrays
                series: [
                    [5, 2, 4, 2, 0]
                ]
            };
            var chart = new Chartist.Bar('#results', data);
            var timers = [];
            window.d=[];
            chart.on('draw', function(data) {
                if(data.type === 'bar') {
                    if (data.index==0)while (timers.length > 0)clearTimeout(timers.pop());
                    var duration=5000*data.series[data.index]/Math.max.apply(null,data.series);
                    data.element.animate({
                        y2: {
                            begin: 0,
                            dur: duration,
                            from: data.y1,
                            to: data.y2,
                            easing: Chartist.Svg.Easing.linear
                        }
                    });
                    window.d.push(data);
                    timers.push(setTimeout(function (data) {
                        barHorizontalCenter = data.x1 + (data.element.width() * .5);
                        barVerticalCenter = data.y1 + (data.element.height() * -1) - 10;
                        value = data.element.attr('ct:value');
                        label = new Chartist.Svg('text');
                        label.text(''+value+' vots');
                        label.addClass("ct-barlabel");
                        label.attr({
                            x: barHorizontalCenter,
                            y: barVerticalCenter,
                            'text-anchor': 'middle'
                        });
                        data.group.append(label);

                    },duration,data));
                    data.element.attr({
                        style:"stroke-width: 30px"
                    });
                }
            });


//            var mychart = new Chart($("#results"),{
//                type: 'bar',
//                data: {
//                    labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
//                    datasets: [{
//                        label: '# of Votes',
//                        data: [12, 19, 3, 5, 2, 3],
//                        backgroundColor: [
//                            'rgba(255, 99, 132, 0.2)',
//                            'rgba(54, 162, 235, 0.2)',
//                            'rgba(255, 206, 86, 0.2)',
//                            'rgba(75, 192, 192, 0.2)',
//                            'rgba(153, 102, 255, 0.2)',
//                            'rgba(255, 159, 64, 0.2)'
//                        ],
//                        borderColor: [
//                            'rgba(255,99,132,1)',
//                            'rgba(54, 162, 235, 1)',
//                            'rgba(255, 206, 86, 1)',
//                            'rgba(75, 192, 192, 1)',
//                            'rgba(153, 102, 255, 1)',
//                            'rgba(255, 159, 64, 1)'
//                        ],
//                        animation:{
//                            duration: [1,1,1,5,1,1]
//                        },
//
//                        borderWidth: 1
//                    }]
//                },
//                options: {
//                    scales: {
//                        yAxes: [{
//                            ticks: {
//                                beginAtZero:false
//                            }
//                        }]
//                    }
//                }
//            });
//            window.myChart=mychart
//            console.log('hola');
            //});

//            new Morris.Bar({
//                // ID of the element in which to draw the chart.
//                element: 'results',
//                // Chart data records -- each entry in this array corresponds to a point on
//                // the chart.
//                data: results.data,
//                // The name of the data record attribute that contains x-values.
//                xkey: '_id',
//                // A list of names of data record attributes that contain y-values.
//                ykeys: ['total'],
//                // Labels for the ykeys -- will be displayed when you hover over the
//                // chart.
//                labels: ['Total'],
//                resize: true
//            });
        };
        xhr.send('pollId=' + pollId + '&idtoken=' + id_token);
    });


</script>


</body>

</html>
